jQuery(document).ready(function(i){var t=/(.+\/)gallery\/([^\/]+)\//gi,e=t.exec(window.location.href);i.gallery={url:e[1],postName:e[2],posts:[],waitingToLoad:-1,showingLoadingAnimation:!1,next:function(){this.current=this.current==this.max-1?0:this.current+1,this.load()},previous:function(){this.current=0===this.current?this.max-1:this.current-1,this.load()},preloadTheNext:function(t){for(var e=this.current,i=this.current+t,l=e;l<i;l++){var r=l;r>this.max-1&&(r=l-this.max),this.preload(r)}},preloadThePrevious:function(t){for(var e=this.current,i=this.current-t,l=e;i<l;l--){var r=l;r<0&&(r=l+this.max),this.preload(r)}},preloadAll:function(){for(r=this.current;r<this.max;r++)this.preload(r);for(r=0;r<this.current;r++)this.preload(r)},preload:function(t){var e=this.posts[t];return!e||e.loaded?(e.loaded&&i("#preload-"+t).remove(),!1):!e.preloading&&void(e.html?(i('<div id="preload-'+t+'" style="position:absolute;left:-9999em;height:1px;width:1px;overflow:hidden;">'+e.html+"</div>").appendTo("body"),this.posts[t].loaded=!0,this.posts[t].preloading=!1,t==this.waitingToLoad&&(this.load(t),this.waitingToLoad=-1,this.showingLoadingAnimation=!1)):(this.posts[t].preloading=!0,i.ajax({url:e.urlToFetch,dataType:"html",success:i.gallery.ajaxCallback(t)})))},scrollIntoView:function(t){t&&(hash=t.split("#")[1])&&(el=document.getElementById(hash))&&el.scrollIntoView()},ajaxCallback:function(e){-1<this.waitingToLoad&&(this.posts[this.waitingToLoad].loaded?this.load(this.waitingToLoad):this.preload(this.waitingToLoad));return function(t){html=i("#content",t),title=t.match(/<title>(.+)<\/title>/gi)[0].replace(/<title>(.+)<\/title>/gi,"$1"),i.gallery.posts[e].html=html.html(),i.gallery.posts[e].title=title,i.gallery.posts[e].preloading=!1,i.gallery.preload(e)}},load:function(t){t||(t=this.current);var e=this.posts[t];if(!e||!e.html)return e.html||(this.showingLoadingAnimation||(loadingBarsHTML="",loadingBarsHTML+='<div class="loading-bars">',loadingBarsHTML+='<div class="rect1"></div>',loadingBarsHTML+='<div class="rect2"></div>',loadingBarsHTML+='<div class="rect3"></div>',loadingBarsHTML+='<div class="rect4"></div>',loadingBarsHTML+='<div class="rect5"></div>',loadingBarsHTML+="</div>",i("#content .inner").html(loadingBarsHTML),this.showingLoadingAnimation=!0),this.waitingToLoad=t),!1;i("#content").html(e.html),document.title=e.title,window.history&&history.pushState&&(newPath=this.url+"gallery/"+e.slug+"/",window.history.replaceState(null,null,newPath))}};var l=function(){var t=i(window).width(),e=[{size:"320-wide",width:320},{size:"360-wide",width:360},{size:"480-wide",width:480},{size:"640-wide",width:640},{size:"800-wide",width:800}];for(r=0;r<e.length;r++)if(img=e[r],t<=img.width)return img.size;return""}();if(postGalleryUrls=i("#post-gallery-urls").val().split(" "),!postGalleryUrls)return!1;i.gallery.posts=[];for(var r=0;r<postGalleryUrls.length;r++){var a=postGalleryUrls[r],o=t.exec(a);o||(o=t.exec(a));var s=o[2];a==e[0]&&(i.gallery.current=r,i.gallery.max=postGalleryUrls.length),urlToFetch=a,l&&(urlToFetch+="size/"+l+"/"),i.gallery.posts.push({url:a,urlToFetch:urlToFetch,slug:s,loaded:!1,html:"",title:""})}i.gallery.preloadTheNext(3),i.gallery.preloadThePrevious(2),i("#content").on("click","nav .next",function(t){t.preventDefault(),i.gallery.next(),i.gallery.scrollIntoView(this.href),i.gallery.preloadTheNext(3)}).on("click","nav .prev",function(t){t.preventDefault(),i.gallery.previous(),i.gallery.scrollIntoView(this.href),i.gallery.preloadThePrevious(3)}),i(document).keydown(function(t){39==t.which&&(t.preventDefault(),i("#content nav .next").eq(0).click()),37==t.which&&(t.preventDefault(),i("#content nav .prev").eq(0).click())})});