jQuery(document).ready(function(t){function i(){return!(!window.history||!history.pushState)}function e(){var i=t(window).width(),e=[{size:"320-wide",width:320},{size:"360-wide",width:360},{size:"480-wide",width:480},{size:"640-wide",width:640},{size:"800-wide",width:800}];for(o=0;o<e.length;o++)if(img=e[o],i<=img.width)return img.size;return""}var l=/(.+\/)gallery\/([^\/]+)\//gi,r=l.exec(window.location.href);t.gallery={url:r[1],postName:r[2],posts:[],waitingToLoad:-1,showingLoadingAnimation:!1,next:function(){this.current=this.current==this.max-1?0:this.current+1,this.load()},previous:function(){this.current=0===this.current?this.max-1:this.current-1,this.load()},preloadTheNext:function(t){for(var i=this.current,e=this.current+t,l=i;l<e;l++){var r=l;r>this.max-1&&(r=l-this.max),this.preload(r)}},preloadThePrevious:function(t){for(var i=this.current,e=this.current-t,l=i;l>e;l--){var r=l;r<0&&(r=l+this.max),this.preload(r)}},preloadAll:function(){for(o=this.current;o<this.max;o++)this.preload(o);for(o=0;o<this.current;o++)this.preload(o)},preload:function(i){var e=this.posts[i];return!e||e.loaded?(e.loaded&&t("#preload-"+i).remove(),!1):!e.preloading&&void(e.html?(t('<div id="preload-'+i+'" style="position:absolute;left:-9999em;height:1px;width:1px;overflow:hidden;">'+e.html+"</div>").appendTo("body"),this.posts[i].loaded=!0,this.posts[i].preloading=!1,i==this.waitingToLoad&&(this.load(i),this.waitingToLoad=-1,this.showingLoadingAnimation=!1)):(this.posts[i].preloading=!0,t.ajax({url:e.urlToFetch,dataType:"html",success:t.gallery.ajaxCallback(i)})))},scrollIntoView:function(t){t&&(hash=t.split("#")[1])&&(el=document.getElementById(hash))&&el.scrollIntoView()},ajaxCallback:function(i){if(this.waitingToLoad>-1){var e=this.posts[this.waitingToLoad];e.loaded?this.load(this.waitingToLoad):this.preload(this.waitingToLoad)}return function(e){html=t("#content",e),title=e.match(/<title>(.+)<\/title>/gi)[0].replace(/<title>(.+)<\/title>/gi,"$1"),t.gallery.posts[i].html=html.html(),t.gallery.posts[i].title=title,t.gallery.posts[i].preloading=!1,t.gallery.preload(i)}},load:function(e){e||(e=this.current);var l=this.posts[e];return l&&l.html?(t("#content").html(l.html),document.title=l.title,void(i()&&(newPath=this.url+"gallery/"+l.slug+"/",window.history.replaceState(null,null,newPath)))):(l.html||(this.showingLoadingAnimation||(loadingBarsHTML="",loadingBarsHTML+='<div class="loading-bars">',loadingBarsHTML+='<div class="rect1"></div>',loadingBarsHTML+='<div class="rect2"></div>',loadingBarsHTML+='<div class="rect3"></div>',loadingBarsHTML+='<div class="rect4"></div>',loadingBarsHTML+='<div class="rect5"></div>',loadingBarsHTML+="</div>",t("#content .inner").html(loadingBarsHTML),this.showingLoadingAnimation=!0),this.waitingToLoad=e),!1)}};var a=e();if(postGalleryUrls=t("#post-gallery-urls").val().split(" "),!postGalleryUrls)return!1;t.gallery.posts=[];for(var o=0;o<postGalleryUrls.length;o++){var n=postGalleryUrls[o],s=l.exec(n);s||(s=l.exec(n));var h=s[2];n==r[0]&&(t.gallery.current=o,t.gallery.max=postGalleryUrls.length),urlToFetch=n,a&&(urlToFetch+="size/"+a+"/"),t.gallery.posts.push({url:n,urlToFetch:urlToFetch,slug:h,loaded:!1,html:"",title:""})}t.gallery.preloadTheNext(3),t.gallery.preloadThePrevious(2),t("#content").on("click","nav .next",function(i){i.preventDefault(),t.gallery.next(),t.gallery.scrollIntoView(this.href),t.gallery.preloadTheNext(3)}).on("click","nav .prev",function(i){i.preventDefault(),t.gallery.previous(),t.gallery.scrollIntoView(this.href),t.gallery.preloadThePrevious(3)}),t(document).keydown(function(i){39==i.which&&(i.preventDefault(),t("#content nav .next").eq(0).click()),37==i.which&&(i.preventDefault(),t("#content nav .prev").eq(0).click())})});