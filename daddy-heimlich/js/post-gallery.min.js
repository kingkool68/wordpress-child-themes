jQuery(document).ready(function(t){function e(){return!(!window.history||!history.pushState)}var i=/(.+\/)gallery\/([^\/]+)\//gi,l=i.exec(window.location.href);t.gallery={url:l[1],postName:l[2],posts:[],waitingToLoad:-1,showingLoadingAnimation:!1,next:function(){this.current=this.current==this.max-1?0:this.current+1,this.load()},previous:function(){this.current=0===this.current?this.max-1:this.current-1,this.load()},preloadTheNext:function(t){for(var e=this.current,i=this.current+t,l=e;l<i;l++){var r=l;r>this.max-1&&(r=l-this.max),this.preload(r)}},preloadThePrevious:function(t){for(var e=this.current,i=this.current-t,l=e;l>i;l--){var r=l;r<0&&(r=l+this.max),this.preload(r)}},preloadAll:function(){for(a=this.current;a<this.max;a++)this.preload(a);for(a=0;a<this.current;a++)this.preload(a)},preload:function(e){var i=this.posts[e];return!i||i.loaded?(i.loaded&&t("#preload-"+e).remove(),!1):!i.preloading&&void(i.html?(t('<div id="preload-'+e+'" style="position:absolute;left:-9999em;height:1px;width:1px;overflow:hidden;">'+i.html+"</div>").appendTo("body"),this.posts[e].loaded=!0,this.posts[e].preloading=!1,e==this.waitingToLoad&&(this.load(e),this.waitingToLoad=-1,this.showingLoadingAnimation=!1)):(this.posts[e].preloading=!0,t.ajax({url:i.urlToFetch,dataType:"html",success:t.gallery.ajaxCallback(e)})))},scrollIntoView:function(t){t&&(hash=t.split("#")[1])&&(el=document.getElementById(hash))&&el.scrollIntoView()},ajaxCallback:function(e){return this.waitingToLoad>-1&&(this.posts[this.waitingToLoad].loaded?this.load(this.waitingToLoad):this.preload(this.waitingToLoad)),function(i){html=t("#content",i),title=i.match(/<title>(.+)<\/title>/gi)[0].replace(/<title>(.+)<\/title>/gi,"$1"),t.gallery.posts[e].html=html.html(),t.gallery.posts[e].title=title,t.gallery.posts[e].preloading=!1,t.gallery.preload(e)}},load:function(i){i||(i=this.current);var l=this.posts[i];if(!l||!l.html)return l.html||(this.showingLoadingAnimation||(loadingBarsHTML="",loadingBarsHTML+='<div class="loading-bars">',loadingBarsHTML+='<div class="rect1"></div>',loadingBarsHTML+='<div class="rect2"></div>',loadingBarsHTML+='<div class="rect3"></div>',loadingBarsHTML+='<div class="rect4"></div>',loadingBarsHTML+='<div class="rect5"></div>',loadingBarsHTML+="</div>",t("#content .inner").html(loadingBarsHTML),this.showingLoadingAnimation=!0),this.waitingToLoad=i),!1;t("#content").html(l.html),document.title=l.title,e()&&(newPath=this.url+"gallery/"+l.slug+"/",window.history.replaceState(null,null,newPath))}};var r=function(){var e=t(window).width(),i=[{size:"320-wide",width:320},{size:"360-wide",width:360},{size:"480-wide",width:480},{size:"640-wide",width:640},{size:"800-wide",width:800}];for(a=0;a<i.length;a++)if(img=i[a],e<=img.width)return img.size;return""}();if(postGalleryUrls=t("#post-gallery-urls").val().split(" "),!postGalleryUrls)return!1;t.gallery.posts=[];for(var a=0;a<postGalleryUrls.length;a++){var o=postGalleryUrls[a],n=i.exec(o);n||(n=i.exec(o));var s=n[2];o==l[0]&&(t.gallery.current=a,t.gallery.max=postGalleryUrls.length),urlToFetch=o,r&&(urlToFetch+="size/"+r+"/"),t.gallery.posts.push({url:o,urlToFetch:urlToFetch,slug:s,loaded:!1,html:"",title:""})}t.gallery.preloadTheNext(3),t.gallery.preloadThePrevious(2),t("#content").on("click","nav .next",function(e){e.preventDefault(),t.gallery.next(),t.gallery.scrollIntoView(this.href),t.gallery.preloadTheNext(3)}).on("click","nav .prev",function(e){e.preventDefault(),t.gallery.previous(),t.gallery.scrollIntoView(this.href),t.gallery.preloadThePrevious(3)}),t(document).keydown(function(e){39==e.which&&(e.preventDefault(),t("#content nav .next").eq(0).click()),37==e.which&&(e.preventDefault(),t("#content nav .prev").eq(0).click())})});